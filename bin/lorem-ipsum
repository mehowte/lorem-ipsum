#!/usr/bin/env ruby

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), *%w[.. lib])
$DATA_DIR = File.join(File.dirname(__FILE__), *%w[.. data])

require 'lorem-ipsum'
require 'optparse'

init_options = { :max_ngraph => 3 }
gen_options = { :words => 100 }

opts = OptionParser.new do |opts|
  opts.banner = "Usage: #{$0} [options] data-files"

  def check_int_arg(val, range = { :min => nil , :max => nil })
    err_msg = "Must specify integer between " \
        "#{range[:min] || "-INF"} and #{range[:max] || "INF"}"

    int_val = val.to_i

    raise err_msg if range[:min] && int_val < range[:min]
    raise err_msg if range[:max] && int_val > range[:max]

    int_val
  end

  opts.on("--max-ngraph MAX",
      "Maximum length of n-graphs to track. Default is 3") do |v|
    init_options[:max_ngraph] = check_int_arg(v, :min => 1)
  end

  opts.on("-w", "--words WORDS",
      "Number of words to generate. Default is 100") do |v|
    gen_options[:words] = check_int_arg(v, :min => 1)
  end

end

begin
  opts.parse!(ARGV)
rescue
  opts.abort
end

files = ARGV.empty? ? Dir.glob($DATA_DIR + "/*") : ARGV

gen = LoremIpsum::Generator.new(files, init_options)
puts gen.generate(gen_options).strip

